{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { GridLinkOperator } from '../../../models';\nimport { buildWarning } from '../../../utils/warning';\nimport { gridColumnFieldsSelector } from '../columns';\n/**\n * Adds default values to the optional fields of a filter items.\n * @param {GridFilterItem} item The raw filter item.\n * @param {React.MutableRefObject<GridApiCommunity>} apiRef The API of the grid.\n * @return {GridFilterItem} The clean filter item with an uniq ID and an always-defined operatorValue.\n * TODO: Make the typing reflect the different between GridFilterInputItem and GridFilterItem.\n */\n\nvar cleanFilterItem = function cleanFilterItem(item, apiRef) {\n  var cleanItem = _extends({}, item);\n\n  if (cleanItem.id == null) {\n    cleanItem.id = Math.round(Math.random() * 1e5);\n  }\n\n  if (cleanItem.operatorValue == null) {\n    // we select a default operator\n    var column = apiRef.current.getColumn(cleanItem.columnField);\n    cleanItem.operatorValue = column && column.filterOperators[0].value;\n  }\n\n  return cleanItem;\n};\n\nvar filterModelDisableMultiColumnsFilteringWarning = buildWarning(['MUI: The `filterModel` can only contain a single item when the `disableMultipleColumnsFiltering` prop is set to `true`.', 'If you are using the community version of the `DataGrid`, this prop is always `true`.'], 'error');\nvar filterModelMissingItemIdWarning = buildWarning(\"MUI: The 'id' field is required on `filterModel.items` when you use multiple filters.\", 'error');\nvar filterModelMissingItemOperatorWarning = buildWarning(['MUI: One of your filtering item have no `operatorValue` provided.', 'This property will become required on `@mui/x-data-grid@6.X`.']);\nexport var sanitizeFilterModel = function sanitizeFilterModel(model, disableMultipleColumnsFiltering, apiRef) {\n  var hasSeveralItems = model.items.length > 1;\n  var items;\n\n  if (hasSeveralItems && disableMultipleColumnsFiltering) {\n    filterModelDisableMultiColumnsFilteringWarning();\n    items = [model.items[0]];\n  } else {\n    items = model.items;\n  }\n\n  var hasItemsWithoutIds = hasSeveralItems && items.some(function (item) {\n    return item.id == null;\n  });\n  var hasItemWithoutOperator = items.some(function (item) {\n    return item.operatorValue == null;\n  });\n\n  if (hasItemsWithoutIds) {\n    filterModelMissingItemIdWarning();\n  }\n\n  if (hasItemWithoutOperator) {\n    filterModelMissingItemOperatorWarning();\n  }\n\n  if (hasItemWithoutOperator || hasItemsWithoutIds) {\n    return _extends({}, model, {\n      items: items.map(function (item) {\n        return cleanFilterItem(item, apiRef);\n      })\n    });\n  }\n\n  if (model.items !== items) {\n    return _extends({}, model, {\n      items: items\n    });\n  }\n\n  return model;\n};\nexport var mergeStateWithFilterModel = function mergeStateWithFilterModel(filterModel, disableMultipleColumnsFiltering, apiRef) {\n  return function (state) {\n    return _extends({}, state, {\n      filter: _extends({}, state.filter, {\n        filterModel: sanitizeFilterModel(filterModel, disableMultipleColumnsFiltering, apiRef)\n      })\n    });\n  };\n};\n/**\n * Generates a method to easily check if a row is matching the current filter model.\n * @param {GridFilterModel} filterModel The model with which we want to filter the rows.\n * @param {React.MutableRefObject<GridApiCommunity>} apiRef The API of the grid.\n * @returns {GridAggregatedFilterItemApplier | null} A method that checks if a row is matching the current filter model. If `null`, we consider that all the rows are matching the filters.\n */\n\nexport var buildAggregatedFilterItemsApplier = function buildAggregatedFilterItemsApplier(filterModel, apiRef) {\n  var items = filterModel.items,\n      _filterModel$linkOper = filterModel.linkOperator,\n      linkOperator = _filterModel$linkOper === void 0 ? GridLinkOperator.And : _filterModel$linkOper;\n\n  var getFilterCallbackFromItem = function getFilterCallbackFromItem(filterItem) {\n    if (!filterItem.columnField || !filterItem.operatorValue) {\n      return null;\n    }\n\n    var column = apiRef.current.getColumn(filterItem.columnField);\n\n    if (!column) {\n      return null;\n    }\n\n    var parsedValue;\n\n    if (column.valueParser) {\n      var _filterItem$value;\n\n      var parser = column.valueParser;\n      parsedValue = Array.isArray(filterItem.value) ? (_filterItem$value = filterItem.value) == null ? void 0 : _filterItem$value.map(function (x) {\n        return parser(x);\n      }) : parser(filterItem.value);\n    } else {\n      parsedValue = filterItem.value;\n    }\n\n    var newFilterItem = _extends({}, filterItem, {\n      value: parsedValue\n    });\n\n    var filterOperators = column.filterOperators;\n\n    if (!(filterOperators != null && filterOperators.length)) {\n      throw new Error(\"MUI: No filter operators found for column '\".concat(column.field, \"'.\"));\n    }\n\n    var filterOperator = filterOperators.find(function (operator) {\n      return operator.value === newFilterItem.operatorValue;\n    });\n\n    if (!filterOperator) {\n      throw new Error(\"MUI: No filter operator found for column '\".concat(column.field, \"' and operator value '\").concat(newFilterItem.operatorValue, \"'.\"));\n    }\n\n    var applyFilterOnRow = filterOperator.getApplyFilterFn(newFilterItem, column);\n\n    if (typeof applyFilterOnRow !== 'function') {\n      return null;\n    }\n\n    var fn = function fn(rowId) {\n      var cellParams = apiRef.current.getCellParams(rowId, newFilterItem.columnField);\n      return applyFilterOnRow(cellParams);\n    };\n\n    return {\n      fn: fn,\n      item: newFilterItem\n    };\n  };\n\n  var appliers = items.map(getFilterCallbackFromItem).filter(function (callback) {\n    return !!callback;\n  });\n\n  if (appliers.length === 0) {\n    return null;\n  }\n\n  return function (rowId, shouldApplyFilter) {\n    var filteredAppliers = shouldApplyFilter ? appliers.filter(function (applier) {\n      return shouldApplyFilter(applier.item.columnField);\n    }) : appliers; // Return `false` as soon as we have a failing filter\n\n    if (linkOperator === GridLinkOperator.And) {\n      return filteredAppliers.every(function (applier) {\n        return applier.fn(rowId);\n      });\n    } // Return `true` as soon as we have a passing filter\n\n\n    return filteredAppliers.some(function (applier) {\n      return applier.fn(rowId);\n    });\n  };\n};\n/**\n * Generates a method to easily check if a row is matching the current quick filter.\n * @param {any[]} values The model with which we want to filter the rows.\n * @param {React.MutableRefObject<GridApiCommunity>} apiRef The API of the grid.\n * @returns {GridAggregatedFilterItemApplier | null} A method that checks if a row is matching the current filter model. If `null`, we consider that all the rows are matching the filters.\n */\n\nexport var buildAggregatedQuickFilterApplier = function buildAggregatedQuickFilterApplier(filterModel, apiRef) {\n  var _filterModel$quickFil = filterModel.quickFilterValues,\n      quickFilterValues = _filterModel$quickFil === void 0 ? [] : _filterModel$quickFil,\n      _filterModel$quickFil2 = filterModel.quickFilterLogicOperator,\n      quickFilterLogicOperator = _filterModel$quickFil2 === void 0 ? GridLinkOperator.And : _filterModel$quickFil2;\n\n  if (quickFilterValues.length === 0) {\n    return null;\n  }\n\n  var columnsFields = gridColumnFieldsSelector(apiRef);\n  var appliersPerColumnField = {};\n  columnsFields.forEach(function (field) {\n    var column = apiRef.current.getColumn(field);\n    var getApplyQuickFilterFn = column == null ? void 0 : column.getApplyQuickFilterFn;\n\n    if (!getApplyQuickFilterFn) {\n      return;\n    }\n\n    appliersPerColumnField[field] = quickFilterValues.map(function (value) {\n      return getApplyQuickFilterFn(value, column, apiRef);\n    });\n  }); // If some value does not have an applier we ignore them\n\n  var sanitizedQuickFilterValues = quickFilterValues.filter(function (value, index) {\n    return Object.keys(appliersPerColumnField).some(function (field) {\n      return appliersPerColumnField[field][index] != null;\n    });\n  });\n  return function (rowId, shouldApplyFilter) {\n    var usedCellParams = {};\n    Object.keys(appliersPerColumnField).forEach(function (columnField) {\n      if (!shouldApplyFilter || shouldApplyFilter(columnField)) {\n        usedCellParams[columnField] = apiRef.current.getCellParams(rowId, columnField);\n      }\n    }); // Return `false` as soon as we have a quick filter value that does not match any column\n\n    if (quickFilterLogicOperator === GridLinkOperator.And) {\n      return sanitizedQuickFilterValues.every(function (value, index) {\n        return Object.keys(appliersPerColumnField).some(function (field) {\n          var _appliersPerColumnFie, _appliersPerColumnFie2;\n\n          if (appliersPerColumnField[field][index] == null) {\n            return false;\n          }\n\n          return (_appliersPerColumnFie = (_appliersPerColumnFie2 = appliersPerColumnField[field])[index]) == null ? void 0 : _appliersPerColumnFie.call(_appliersPerColumnFie2, usedCellParams[field]);\n        });\n      });\n    } // Return `true` as soon as we have have a quick filter value that match any column\n\n\n    return sanitizedQuickFilterValues.some(function (value, index) {\n      return Object.keys(appliersPerColumnField).some(function (field) {\n        var _appliersPerColumnFie3, _appliersPerColumnFie4;\n\n        if (appliersPerColumnField[field][index] == null) {\n          return false;\n        }\n\n        return (_appliersPerColumnFie3 = (_appliersPerColumnFie4 = appliersPerColumnField[field])[index]) == null ? void 0 : _appliersPerColumnFie3.call(_appliersPerColumnFie4, usedCellParams[field]);\n      });\n    });\n  };\n};\nexport var buildAggregatedFilterApplier = function buildAggregatedFilterApplier(filterModel, apiRef) {\n  var isRowMatchingFilterItems = buildAggregatedFilterItemsApplier(filterModel, apiRef);\n  var isRowMatchingQuickFilter = buildAggregatedQuickFilterApplier(filterModel, apiRef);\n\n  if (isRowMatchingFilterItems == null && isRowMatchingQuickFilter == null) {\n    return null;\n  }\n\n  if (isRowMatchingFilterItems == null) {\n    return isRowMatchingQuickFilter;\n  }\n\n  if (isRowMatchingQuickFilter == null) {\n    return isRowMatchingFilterItems;\n  }\n\n  return function (rowId, shouldApplyFilter) {\n    return isRowMatchingFilterItems(rowId, shouldApplyFilter) && isRowMatchingQuickFilter(rowId, shouldApplyFilter);\n  };\n};","map":null,"metadata":{},"sourceType":"module"}